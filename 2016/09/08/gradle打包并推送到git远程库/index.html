<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-bounce.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.jpg?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Android studio," />





  <link rel="alternate" href="/atom.xml" title="echoMu的个人空间" type="application/atom+xml" />






<meta name="description" content="我们希望在打包的时候能够做到：  使用 Android studio ,使用 gradle 进行构建； 在实际开发中，需要配置我们的 gradle 脚本以支持参数化的方式； 想获得一个可配置打包脚本的方法，允许配置人员根据需要修改服务器地址，versionCode, versionName等； 隔离的源代码的配置，使用者在shell脚本里进行配置。  在阅读本文之前，一些关于gradle的配置项，">
<meta name="keywords" content="Android studio">
<meta property="og:type" content="article">
<meta property="og:title" content="gradle打包并推送到git远程库">
<meta property="og:url" content="http://echomu.github.io/2016/09/08/gradle打包并推送到git远程库/index.html">
<meta property="og:site_name" content="echoMu的个人空间">
<meta property="og:description" content="我们希望在打包的时候能够做到：  使用 Android studio ,使用 gradle 进行构建； 在实际开发中，需要配置我们的 gradle 脚本以支持参数化的方式； 想获得一个可配置打包脚本的方法，允许配置人员根据需要修改服务器地址，versionCode, versionName等； 隔离的源代码的配置，使用者在shell脚本里进行配置。  在阅读本文之前，一些关于gradle的配置项，">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-02-11T02:39:26.201Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="gradle打包并推送到git远程库">
<meta name="twitter:description" content="我们希望在打包的时候能够做到：  使用 Android studio ,使用 gradle 进行构建； 在实际开发中，需要配置我们的 gradle 脚本以支持参数化的方式； 想获得一个可配置打包脚本的方法，允许配置人员根据需要修改服务器地址，versionCode, versionName等； 隔离的源代码的配置，使用者在shell脚本里进行配置。  在阅读本文之前，一些关于gradle的配置项，">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://echomu.github.io/2016/09/08/gradle打包并推送到git远程库/"/>





  <title>gradle打包并推送到git远程库 | echoMu的个人空间</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">echoMu的个人空间</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">听风在鼓舞，还有我作伴</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://echomu.github.io/2016/09/08/gradle打包并推送到git远程库/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="echoMu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="echoMu的个人空间">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">gradle打包并推送到git远程库</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-08T16:39:59+08:00">
                2016-09-08
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/09/08/gradle打包并推送到git远程库/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/09/08/gradle打包并推送到git远程库/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>我们希望在打包的时候能够做到：</p>
<ol>
<li>使用 Android studio ,使用 gradle 进行构建；</li>
<li>在实际开发中，需要配置我们的 gradle 脚本以支持参数化的方式；</li>
<li>想获得一个可配置打包脚本的方法，允许配置人员根据需要修改服务器地址，versionCode, versionName等；</li>
<li>隔离的源代码的配置，使用者在shell脚本里进行配置。</li>
</ol>
<p>在阅读本文之前，一些关于gradle的配置项，可以通过这篇文章复习了解<br><a href="http://www.jianshu.com/p/1a320062aedd" target="_blank" rel="noopener">Android使用gradle打包的各种配置</a></p>
<a id="more"></a>
<p>#####一.自动打包和推送git的shell脚本<br>XXX_autoReleaseToGit.sh<br>这个脚本会顺序执行打包脚本XXX_assemble.sh和git操作脚本XXX_PUSH_APK.sh，结果是可以根据使用者的选择打包出发布版本、测试版本（极光正式key）和测试版本（极光测试key）。当然，你也可以通过修改脚本，一次性打包出以上版本。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 自动打包和推送git的shell脚本</span><br><span class="line"># 打开自动打包工具目录</span><br><span class="line"># 执行打包脚本</span><br><span class="line">cd 你的自动打包工具目录</span><br><span class="line">echo <span class="string">"进入自动化打包脚本目录..."</span></span><br><span class="line">pwd</span><br><span class="line">#使用gradle命令进行打包</span><br><span class="line">echo <span class="string">"使用gradle命令开始打包..."</span></span><br><span class="line">`dirname $&#123;<span class="number">0</span>&#125;`/XXX_assemble.sh</span><br><span class="line">#推送到git远程库</span><br><span class="line">echo <span class="string">"git操作开始..."</span></span><br><span class="line">`dirname $&#123;<span class="number">0</span>&#125;`/XXX_PUSH_APK.sh</span><br></pre></td></tr></table></figure>
<p><strong><strong>执行shell脚本进行自动打包</strong></strong><br>XXX_assembleRelease.sh<br>这个脚本包含了代码分支更新、代码更新、选择打包环境和第三方服务（极光推送）的操作。</p>
<p>参数都是自定义的，这里写入了多个参数，有指定的各个服务器地址，apk输入文件路径，和环境标识后缀名、极光标识。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">project_path=<span class="string">"你的工程根目录"</span></span><br><span class="line">gradlew_path=<span class="string">"$&#123;project_path&#125;/gradlew"</span></span><br><span class="line"># 切换到项目目录</span><br><span class="line">cd $&#123;project_path&#125;</span><br><span class="line">echo <span class="string">"切换到项目目录..."</span></span><br><span class="line">pwd</span><br><span class="line"></span><br><span class="line"># 进行代码分支选择 </span><br><span class="line">echo <span class="string">"正在更新代码分支信息..."</span></span><br><span class="line"></span><br><span class="line"># 更新分支信息</span><br><span class="line">git fetch -p</span><br><span class="line"></span><br><span class="line"># 获取所有远程分支信息</span><br><span class="line">remote_branchs=`git branch -r`</span><br><span class="line"># 分割成数组后让使用者选择打包分支</span><br><span class="line">echo <span class="string">"请选择待打包分支: "</span></span><br><span class="line">echo <span class="string">"请选择待打包分支: "</span></span><br><span class="line">arr=($&#123;remote_branchs<span class="comment">// /&#125;)</span></span><br><span class="line">index=<span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i in $&#123;arr[@]&#125;; <span class="keyword">do</span></span><br><span class="line"> #statements</span><br><span class="line"> echo $&#123;index&#125;<span class="string">". "</span>$&#123;i:<span class="number">7</span>&#125;</span><br><span class="line"> ((index++))</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"># 读取使用者数据</span><br><span class="line">read branch_index</span><br><span class="line">echo <span class="string">"你选择要打包的分支是： $&#123;branch_index&#125; "</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ -z $&#123;branch_index&#125; ]]; then</span><br><span class="line"> echo <span class="string">"Error: 选择的分支序号不合法"</span> </span><br><span class="line"> echo <span class="string">"Error: 选择的分支序号不合法"</span></span><br><span class="line">fi</span><br><span class="line">((branch_index--))</span><br><span class="line"># 切换branch并拉取最新代码</span><br><span class="line">echo <span class="string">"切换到该分支并拉取最新代码..."</span></span><br><span class="line"><span class="keyword">if</span> [[ $&#123;arr[$&#123;branch_index&#125;]&#125; =~ <span class="string">"HEAD"</span> ]]; then</span><br><span class="line"> echo <span class="string">"Error: 不能切换到该分支($&#123;arr[$&#123;branch_index&#125;]&#125;)"</span> </span><br><span class="line"> echo <span class="string">"Error: 不能切换到该分支($&#123;arr[$&#123;branch_index&#125;]&#125;)"</span></span><br><span class="line"> exit <span class="number">1</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># git reset --hard HEAD</span><br><span class="line">#result_code=$?</span><br><span class="line">git checkout $&#123;arr[$&#123;branch_index&#125;]:<span class="number">7</span>&#125; </span><br><span class="line">result_code=$?</span><br><span class="line">git pull </span><br><span class="line">result_code=$?</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ $&#123;result_code&#125; != <span class="number">0</span> ]]; then</span><br><span class="line"> echo <span class="string">"Error: 拉取代码失败"</span> </span><br><span class="line"> echo <span class="string">"Error: 拉取代码失败"</span></span><br><span class="line"> exit <span class="number">1</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># gradlew文件增加可执行权限</span><br><span class="line">chmod u+x $&#123;gradlew_path&#125;</span><br><span class="line"></span><br><span class="line">echo <span class="string">"请选择版本的环境地址"</span></span><br><span class="line">echo <span class="string">"1:正式环境"</span></span><br><span class="line">echo <span class="string">"2:测试环境"</span></span><br><span class="line"></span><br><span class="line">read environment</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 执行gradlew.bat 进行打包</span><br><span class="line"># -P表示后面的是自定义参数 如-POUT_PUT_DIR_PARA 表示自定义了一个OUT_PUT_DIR_PARA参数 后面是赋值</span><br><span class="line"># OUT_PUT_DIR_PARA APK输出目录</span><br><span class="line"># BASE_URL_PARA 服务器基本请求地址</span><br><span class="line"># ENVIRONMENT_PARA 服务器环境表示 1.real 正式环境 2.test 测试环境</span><br><span class="line"># JPUSH_APPKEY_PARA 只要有自定义这个参数 就代表要输出极光推送的APK</span><br><span class="line"><span class="keyword">if</span> [[ $&#123;environment&#125; = <span class="number">1</span> ]]; then</span><br><span class="line"> #statements</span><br><span class="line"> echo <span class="string">"你选择要打包的地址是：正式环境"</span></span><br><span class="line"> $&#123;gradlew_path&#125; assembleRelease -POUT_PUT_DIR_PARA=你的APK输出目录 -PBASE_URL_PARA=你的正式环境服务器地址 -PENVIRONMENT_PARA=real --info --stacktrace</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"> #statements</span><br><span class="line"> echo <span class="string">"你选择要打包的地址是：测试环境"</span></span><br><span class="line"> echo <span class="string">"----"</span></span><br><span class="line"> echo <span class="string">"请选择版本的极光Key"</span></span><br><span class="line"> echo <span class="string">"1:正式Key"</span></span><br><span class="line"> echo <span class="string">"2:测试Key"</span></span><br><span class="line"></span><br><span class="line"> read jpushAppKey</span><br><span class="line"> <span class="keyword">if</span> [[ $&#123;jpushAppKey&#125; = <span class="number">1</span> ]]; then</span><br><span class="line">  #statements</span><br><span class="line">  echo <span class="string">"你选择要打包的极光Key是：正式Key"</span></span><br><span class="line">  $&#123;gradlew_path&#125; assembleRelease -POUT_PUT_DIR_PARA=你的APK输出目录 -PBASE_URL_PARA=你的测试环境服务器地址 -PENVIRONMENT_PARA=test --info --stacktrace</span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line">  #statements</span><br><span class="line">  echo <span class="string">"你选择要打包的极光Key是：测试Key"</span></span><br><span class="line">  $&#123;gradlew_path&#125; assembleRelease -POUT_PUT_DIR_PARA=你的APK输出目录 -PBASE_URL_PARA=你的测试环境服务器地址 -PENVIRONMENT_PARA=test_int -PJPUSH_APPKEY_PARA=<span class="number">1</span> --info --stacktrace</span><br><span class="line"> fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>####二.配置gradle文件<br><strong>配置 defaultConfig 节点</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">defaultConfig &#123;  </span><br><span class="line">   <span class="keyword">if</span> (project.hasProperty(<span class="string">'JPUSH_APPKEY_PARA'</span>)) &#123;            </span><br><span class="line">       <span class="comment">//如果有指定极光key的自定义参数，那么就设置极光推送测试key对应的appId                         </span></span><br><span class="line">        applicationId project.APPLICATIONID_JPUSH        </span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;            </span><br><span class="line">       <span class="comment">//工程本来的appId            </span></span><br><span class="line">       applicationId project.APPLICATIONID_RELEASE        </span><br><span class="line">   &#125;        </span><br><span class="line">  <span class="comment">//最低安装版本Android 4.0        </span></span><br><span class="line">  minSdkVersion rootProject.ext.minSdkVersion        </span><br><span class="line">  targetSdkVersion rootProject.ext.targetSdkVersion        </span><br><span class="line">  versionCode rootProject.ext.versionCode        </span><br><span class="line">  versionName rootProject.ext.versionName        </span><br><span class="line">  <span class="comment">// dex突破65535的限制        </span></span><br><span class="line">  multiDexEnabled <span class="keyword">true</span>        </span><br><span class="line">  manifestPlaceholders = [                </span><br><span class="line">        <span class="comment">// 默认是umeng测试的渠道                </span></span><br><span class="line">        UMENG_CHANNEL_VALUE: <span class="string">"TEST"</span>,                </span><br><span class="line">        <span class="comment">// 默认是正式的极光key </span></span><br><span class="line">        JPUSH_APPKEY: project.JPUSH_APPKEY_VALUE_RELEASE        </span><br><span class="line">  ]        </span><br><span class="line">  <span class="comment">//配置 defaultConfig 下的  buildConfigField字段 ,这是为了 代码编译的方便，使得在各个环境下都有 BASE_URL 这个字段。        </span></span><br><span class="line">  <span class="comment">//正式服务器        </span></span><br><span class="line">  buildConfigField(<span class="string">"String"</span>, <span class="string">"BASE_URL"</span>, <span class="string">"\""</span> + project.BASE_URL_REAL + <span class="string">"\""</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>配置debug节点各个服务器地址的值</strong><br>同配置defaultConfig节点一样</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">debug &#123;</span><br><span class="line">    <span class="comment">//测试服务器请求</span></span><br><span class="line">    buildConfigField(<span class="string">"String"</span>, <span class="string">"BASE_URL"</span>, <span class="string">"\""</span> + project.BASE_URL_TEST + <span class="string">"\""</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>配置release节点</strong><br>读取上面XXX_assemble.sh文件传入的参数的值作为各个服务器地址的值。<br>在读取参数的时候，我们先检查参数是否存在，使用代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">project.hasProperty(<span class="string">'参数名'</span>)</span><br></pre></td></tr></table></figure>
<p>所有通过命令行传入的参数都或作为 project 内建对象的属性，我们这里判断了指定的参数名是否存在。如何使用参数呢？直接使用即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">versionCode Integer.parseInt(VERSION_CODE_PARA) <span class="comment">//注意这里，进行了转型，从字符串转型为 int 类型</span></span><br><span class="line">versionName VERSION_NAME_PARA</span><br></pre></td></tr></table></figure>
<p>和普通的变量使用方法是一样的。我们还会遇到在字符串中使用的时候，可以使用表达式 来引用，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;参数名&#125;</span><br></pre></td></tr></table></figure>
<p>示例;<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fileName = fileName.replace(<span class="string">".apk"</span>, <span class="string">"-$&#123;android.defaultConfig.versionName&#125;.apk"</span>)</span><br></pre></td></tr></table></figure></p>
<p>详细如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个打包时间</span></span><br><span class="line"><span class="function">def <span class="title">releaseTime</span><span class="params">()</span> </span>&#123;    </span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Date().format(<span class="string">"yyyyMMdd"</span>, TimeZone.getTimeZone(<span class="string">"UTC"</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  buildTypes &#123;</span><br><span class="line">      debug &#123;</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line">      ...    </span><br><span class="line">      release &#123;</span><br><span class="line">        ... </span><br><span class="line">        <span class="keyword">if</span> (project.hasProperty(<span class="string">'JPUSH_APPKEY_PARA'</span>)) &#123;                </span><br><span class="line">            <span class="comment">//接收自定义参数的值，指定测试的极光key</span></span><br><span class="line">            manifestPlaceholders = [</span><br><span class="line">                  JPUSH_APPKEY: project.JPUSH_APPKEY_VALUE_DEBUG</span><br><span class="line">            ]            </span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">        applicationVariants.all &#123; </span><br><span class="line">            variant -&gt;    variant.outputs.each &#123; output -&gt;        </span><br><span class="line">                def outputFile = output.outputFile        </span><br><span class="line">                <span class="keyword">if</span> (outputFile != <span class="keyword">null</span> &amp;&amp; outputFile.name.endsWith(<span class="string">'.apk'</span>)) &#123;           </span><br><span class="line">                    <span class="comment">// 输出apk名称为XXX20160328_v1.0.0_vc10_XXXX_test.apk        </span></span><br><span class="line">                    <span class="keyword">if</span> (project.hasProperty(<span class="string">'ENVIRONMENT_PARA'</span>) </span><br><span class="line">                    def fileName=<span class="string">" XXX$&#123;releaseTime()&#125;_v$&#123;defaultConfig.versionName&#125;_vc$&#123;defaultConfig.versionCode&#125;_$&#123;variant.productFlavors[0].name&#125;_$&#123;ENVIRONMENT_PARA&#125;.apk"</span>                  </span><br><span class="line">                    <span class="comment">//控制输出的APK的存放路径                </span></span><br><span class="line">                    <span class="keyword">if</span> (project.hasProperty(<span class="string">'OUT_PUT_DIR_PARA'</span>)) &#123;                    </span><br><span class="line">                        File output_dir1 = file(<span class="string">"$&#123;OUT_PUT_DIR_PARA&#125;"</span>);                    </span><br><span class="line">                        output.outputFile = <span class="keyword">new</span> File(output_dir1, fileName)                    </span><br><span class="line">                         println <span class="string">"输出文件位置： "</span> + output.outputFile                </span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;                    </span><br><span class="line">                        output.outputFile = <span class="keyword">new</span> File(outputFile.parent, fileName)                    </span><br><span class="line">                        println <span class="string">"输出文件位置： "</span> + output.outputFile                </span><br><span class="line">                    &#125;            </span><br><span class="line">                 &#125;        </span><br><span class="line">              &#125;    </span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        productFlavors.all &#123; </span><br><span class="line">            flavor -&gt;    flavor.manifestPlaceholders = [UMENG_CHANNEL_VALUE: name]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>####三.打包完成之后，将APK提交并推送到git远程库<br>XXX_PUSH_APK.sh</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cd 你的APK输出目录</span><br><span class="line">pwd</span><br><span class="line">#同步远程库</span><br><span class="line">git pull;</span><br><span class="line">#add新增加的APK文件</span><br><span class="line">git add *;</span><br><span class="line">#提交APK</span><br><span class="line">git commit -m <span class="string">'提交APK'</span>;</span><br><span class="line">#推送到远程库</span><br><span class="line">git push;</span><br></pre></td></tr></table></figure>
<p>将以上工作做完之后，我们就可以通过执行脚本来打包了，我们可以打出一系列debug和release的不同服务器环境的版本，对应不同的第三方服务的版本（如极光推送生产环境和发布环境的版本）。当然，你可以修改脚本，写入定时执行功能，将脚本完全写成自动化定时执行的脚本。</p>
<p><a href="https://github.com/mumubin5/Android-" target="_blank" rel="noopener">github版本:Android 自动化打包实践 gradle打包并推送到git远程库</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android-studio/" rel="tag"># Android studio</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/09/08/代码混淆在AS的实践/" rel="next" title="代码混淆在AS的实践">
                <i class="fa fa-chevron-left"></i> 代码混淆在AS的实践
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/09/08/使用gradle打包的各种配置/" rel="prev" title="使用gradle打包的各种配置">
                使用gradle打包的各种配置 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
<span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_fav">收藏夹</a>
<a class="jiathis_button_copy">复制网址</a>
<a class="jiathis_button_email">邮件</a>
<a class="jiathis_button_weixin">微信</a>
<a class="jiathis_button_qzone">QQ空间</a>
<a class="jiathis_button_tqq">腾讯微博</a>
<a class="jiathis_button_douban">豆瓣</a>
<a class="jiathis_button_share">一键分享</a>

<a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
var jiathis_config={
  data_track_clickback:true,
  summary:"",
  shortUrl:false,
  hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script>
<!-- JiaThis Button END -->
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="echoMu" />
            
              <p class="site-author-name" itemprop="name">echoMu</p>
              <p class="site-description motion-element" itemprop="description">普通搬砖工一枚，记录、分享</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/echoMu" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.jianshu.com/u/8ca6e856cc26" target="_blank" title="简书">
                      
                        <i class="fa fa-fw fa-link"></i>简书</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://xiaocaiyibin100@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">echoMu</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://hi.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://echomu.github.io/2016/09/08/gradle打包并推送到git远程库/';
          this.page.identifier = '2016/09/08/gradle打包并推送到git远程库/';
          this.page.title = 'gradle打包并推送到git远程库';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://hi.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  














  





  

  

  

  
  

  

  

  

</body>
</html>
